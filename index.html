<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>تقرير رفع موقع - Field Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{background:#0b3d2e;color:#0f172a;font-family:Verdana,'Cairo',system-ui}
    .card{border-radius:12px;background:#eef2f6;box-shadow:0 2px 8px rgba(0,0,0,.12);border:0}
    .card-header{font-weight:700;background:transparent;border-bottom:1px solid rgba(0,0,0,.06)}
    .form-control{padding:.45rem .6rem}
    .btn{min-width:110px}
    .hint{color:#94a3b8}
    .banner{display:none} /* hidden by default per user request */
    .pill{display:inline-flex;gap:6px;align-items:center;padding:2px 8px;border-radius:999px;font-size:.78rem}
    .pill.ok{background:#dcfce7;color:#065f46}
    .pill.warn{background:#fef3c7;color:#92400e}
    .pill.muted{background:#e5e7eb;color:#374151}
    /* POP list compact */
    .pop-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .pop-item{display:flex;align-items:center;justify-content:space-between;gap:12px;background:#fff;border-radius:10px;padding:8px 10px}
    .pop-left{display:flex;align-items:center;gap:10px;min-width:0}
    .pop-title{font-weight:700;font-size:.92rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:46vw}
    .pop-meta{color:#475569;font-size:.8rem;white-space:nowrap}
    /* Arrow larger and clearer */
    .arrow{width:44px;height:44px;flex:0 0 44px;transition:transform 120ms linear;display:inline-block}
    .arrow svg{width:100%;height:100%}
    .pop-actions .btn{background:#0a6;border:0;border-radius:8px;padding:6px 10px;font-size:.82rem}
    .smallmuted{color:#cbd5e1;font-size:.9rem}
    table input{min-width:130px}
    /* responsive tweaks */
    @media (max-width:720px){ .pop-title{max-width:38vw;font-size:.86rem} }
    /* subtle debug console (hidden) */
    #dbg{display:none;font-family:monospace;color:#cbd5e1;font-size:.8rem;margin-top:6px}
  </style>
  <script src="app.js?v=2" defer></script>
</head>
<body>
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-2 text-white">
    <h1 class="h5 m-0">تقرير رفع موقع</h1><span class="badge bg-light text-dark">Field Tool</span>
  </div>

  <div id="insecureBanner" class="banner"></div>

  <div class="card mb-3">
    <div class="card-header">معلومات الزبون والموقع</div>
    <div class="card-body row g-2">
      <div class="col-md-4"><label class="form-label">اسم الكوستمر *</label><input id="customerName" class="form-control" placeholder="مثال: شركة س"></div>
      <div class="col-md-4"><label class="form-label">رقم الهاتف</label><input id="phone" class="form-control" placeholder="07xx xxx xxxx"></div>
      <div class="col-md-4"><label class="form-label">الباند *</label><input id="bandField" class="form-control" placeholder="5GHz / Fiber"></div>

      <div class="col-md-9 mt-2">
        <label class="form-label">الموقع *</label>
        <div class="d-flex flex-wrap gap-2">
          <input id="location" class="form-control" placeholder="33.3152, 44.3661">
          <button id="pickLoc" class="btn btn-outline-primary btn-sm">📍 التقاط تلقائي</button>
          <button id="trackBtn" class="btn btn-outline-primary btn-sm">▶️ تشغيل التتبع</button>
          <button id="openMapBtn" class="btn btn-outline-primary btn-sm">🗺️ فتح بالخريطة</button>
          <button id="nearestBtn" class="btn btn-success btn-sm">🔍 أقرب 3 بوبات</button>
          <button id="compassBtn" class="btn btn-outline-primary btn-sm">🧭 تفعيل البوصلة</button>
        </div>
        <div class="d-flex gap-2 mt-2">
          <span id="gpsPill" class="pill muted">GPS: غير مفعل</span>
          <span id="compassPill" class="pill muted">Compass: غير متاح</span>
          <span id="popsPill" class="pill muted">POPs: جارٍ التحميل...</span>
        </div>
        <div id="statusBar" class="small text-secondary mt-2"></div>
        <div id="trackInfo" class="smallmuted"></div>
        <div id="nearestResult" class="pop-list" aria-live="polite"></div>
        <div id="dbg"></div>
      </div>

      <div class="col-md-3"><label class="form-label">التاريخ</label><input id="reportDate" type="date" class="form-control"></div>
      <div class="col-md-3"><label class="form-label">اسم الفني *</label><input id="techName" class="form-control"></div>
      <div class="col-md-3"><label class="form-label">المتابعة مع *</label><input id="engName" class="form-control"></div>
      <div class="col-md-3"><label class="form-label">POP/بوب</label><input id="popField" class="form-control"></div>
      <div class="col-md-3"><label class="form-label">العبّار</label><input id="abarField" class="form-control"></div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-header">الصور المطلوبة</div>
    <div class="card-body row g-2">
      <div class="col-md-6"><label class="form-label">صورة باتجاه البوب *</label><input id="img_pop" type="file" accept="image/*" class="form-control"></div>
      <div class="col-md-6"><label class="form-label">صورة مكان التور/البول *</label><input id="img_tower" type="file" accept="image/*" class="form-control"></div>
      <div class="col-md-6"><label class="form-label">صورة مكان نصب الراك/الراوتر *</label><input id="img_rack" type="file" accept="image/*" class="form-control"></div>
      <div class="col-md-6"><label class="form-label">صور أماكن تسليك الكيبلات *</label><input id="img_cables" type="file" accept="image/*" multiple class="form-control"></div>
      <div class="col-md-6"><label class="form-label">صور أخرى (اختياري)</label><input id="img_other" type="file" accept="image/*" multiple class="form-control"></div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>المواد المطلوبة</span>
      <button id="addCustomRow" class="btn btn-success btn-sm">➕ إضافة مادة</button>
    </div>
    <div class="card-body p-2">
      <div class="table-responsive">
        <table class="table table-sm align-middle m-0">
          <thead class="table-light"><tr><th>الجهاز</th><th>التفاصيل</th><th style="width:12%">العدد</th><th>ملاحظات</th><th style="width:8%"></th></tr></thead>
          <tbody id="extrasBody">
            <tr><td>الدش (Dish)</td><td><input type="text" class="form-control extra-det"></td><td><input type="number" min="0" class="form-control extra-qty"></td><td><input type="text" class="form-control extra-note"></td><td></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="d-flex gap-2 mb-3">
    <button id="exportBtn" class="btn btn-primary btn-sm">💾 تصدير PDF</button>
    <button id="shareBtn" class="btn btn-outline-primary btn-sm">🔗 مشاركة</button>
    <div id="statusBar2" class="align-self-center ms-2 text-white"></div>
  </div>
</div>
</body>
</html>
